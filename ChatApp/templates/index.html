<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Sasta Chat App</title>
  </head>
  <body>

    <nav class="navbar navbar-light" style="background-color: #e3f2fd; ">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">
            <img src="https://source.unsplash.com/random" alt="" width="30" height="30" class="d-inline-block align-text-top">
            Sasta Chat App | {{group_name}}
          </a>
        </div>
      </nav>

<div class="container mt-4">
  <div class='container mt-3 text-center mb-4'>
    <h2>Group Name :-) <i>{{group_name}}</i></h2>
  </div>
  <textarea class="form-control" id="c-log" cols="60" rows="10"></textarea>

  {% for chat in chats %}
  {{chat.content}}
  {% endfor %}

  <br>
  <input type="text" class="form-control" id="c-message" placeholder="Itthe likh bro" size="100">
  <br>
  <button type="button" class="btn btn-primary" value="Send" id="c-m-submit">Send It</button>
</div>

{{group_name|json_script:"c-group-name"}}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script>

  const group_name = JSON.parse(document.getElementById('c-group-name').textContent);
  console.log(group_name) 
  var ws = new WebSocket(
    "ws://" 
  + window.location.host 
  + "/ws/sync/" 
  + group_name 
  + "/"
  );

//  var ws = new WebSocket("ws://localhost:8000/ws/sync/");
    ws.onopen = function(){
        console.log("connected");
    }
    ws.onmessage = function(event){
        const data = JSON.parse(event.data);
        console.log('message' , event.data);
        document.querySelector('#c-log').value += data.message  + "\n"; 
    }
    ws.onclose = function(){
        console.log("disconnected");
    }

    document.getElementById('c-m-submit').addEventListener('click', function(){
        var message = document.getElementById('c-message').value;
        ws.send(JSON.stringify({
            'message' : message
        }));
        document.getElementById('c-message').value = "";
    })

    ws.onmessage = function(event) {
      const data = JSON.parse(event.data);
      console.log('message', event.data);
      const cLog = document.querySelector('#c-log');
      
      // Append the new message to the existing content in the textarea
      cLog.value += data.message + "\n";
      
      // Scroll to the bottom to show the latest message
      cLog.scrollTop = cLog.scrollHeight;
    }



</script> 
</body>
</html>